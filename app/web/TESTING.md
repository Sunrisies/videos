# 功能测试指南

本文档说明如何测试新增的密码验证和视频播放交互功能。

## 测试环境

- **开发服务器地址**: http://localhost:13000
- **默认密码**: video123 (配置在 .env.local 文件中)

## 一、密码验证功能测试

### 1.1 首次访问测试

**测试步骤**：
1. 打开浏览器新标签页（或无痕模式）
2. 访问 http://localhost:13000/videos
3. **预期结果**：应该被重定向到 http://localhost:13000/auth 密码验证页面

### 1.2 密码输入测试

**测试步骤**：
1. 在密码输入框中输入错误密码（如 "123456"）
2. 点击"确认"按钮
3. **预期结果**：显示"密码错误，请重试"错误提示，输入框被清空

4. 在密码输入框中输入正确密码 "video123"
5. 点击"确认"按钮（或按回车键）
6. **预期结果**：验证成功，跳转到视频列表页 /videos

### 1.3 授权状态保持测试

**测试步骤**：
1. 在验证通过后，刷新页面（F5）
2. **预期结果**：仍然停留在视频列表页，无需重新输入密码

3. 直接访问 http://localhost:13000/videos/play
4. **预期结果**：可以正常访问，不需要重新验证

### 1.4 会话失效测试

**测试步骤**：
1. 关闭当前浏览器标签页
2. 打开新标签页，访问 http://localhost:13000/videos
3. **预期结果**：需要重新输入密码（sessionStorage 失效）

### 1.5 首页按钮测试

**测试步骤**：
1. 未授权状态下访问 http://localhost:13000
2. 点击"浏览视频库"按钮
3. **预期结果**：跳转到密码验证页
4. 输入正确密码后，应该跳转到视频列表页

---

## 二、视频播放交互功能测试

### 2.1 单击切换控制栏测试

**测试步骤**：
1. 进入视频列表页，点击任意视频进入播放页面
2. 等待视频开始播放，控制栏会在3秒后自动隐藏
3. **单击视频画面中央区域**
4. **预期结果**：控制栏重新显示

5. 再次**单击视频画面**
6. **预期结果**：控制栏隐藏

7. 在视频暂停状态下，单击视频画面
8. **预期结果**：仅切换控制栏显示状态，不触发播放

### 2.2 拖动调整进度测试（移动端或触摸屏）

**测试步骤**：
1. 在视频播放页面，使用手指在视频画面上**向右滑动**（至少移动10px以上）
2. **预期结果**：
   - 视频画面中央偏上位置出现进度预览气泡
   - 气泡显示 "当前时间 / 总时长"
   - 控制栏保持显示

3. 继续拖动，观察预览时间的变化
4. **预期结果**：预览时间随拖动距离实时更新

5. 松开手指
6. **预期结果**：
   - 视频跳转到拖动预览的时间点
   - 预览气泡延迟300ms后消失
   - 如果视频正在播放，3秒后控制栏自动隐藏

### 2.3 拖动方向测试

**测试步骤**：
1. 在视频画面上**向左滑动**
2. **预期结果**：进度向前调整（时间减少）

3. 在视频画面上**向右滑动**
4. **预期结果**：进度向后调整（时间增加）

5. 拖动到视频开始位置（0秒）之前
6. **预期结果**：进度被限制在 0 秒，不会出现负数

7. 拖动到视频结束位置之后
8. **预期结果**：进度被限制在视频总时长，不会超出

### 2.4 单击与拖动区分测试

**测试步骤**：
1. 在视频画面上**快速点击**（触摸时间 < 300ms，移动距离 < 10px）
2. **预期结果**：识别为单击，切换控制栏显示，不调整进度

3. 在视频画面上**按住并小幅移动**（移动距离 < 10px）
4. **预期结果**：识别为单击，不进入拖动模式

5. 在视频画面上**按住并移动超过10px**
6. **预期结果**：识别为拖动，显示预览气泡，调整进度

### 2.5 拖动过程中控制栏行为测试

**测试步骤**：
1. 隐藏控制栏状态下，开始拖动
2. **预期结果**：控制栏自动显示

3. 拖动结束后继续播放
4. **预期结果**：3秒后控制栏自动隐藏

### 2.6 加载和错误状态测试

**测试步骤**：
1. 在视频加载中（显示"加载中..."）时，尝试拖动和单击
2. **预期结果**：不响应触摸事件，防止误操作

3. 在视频加载失败（显示错误信息）时，尝试拖动和单击
4. **预期结果**：不响应触摸事件

---

## 三、兼容性测试

### 3.1 PC 端测试（鼠标操作）

**注意**：当前实现主要针对移动端触摸事件，PC 端使用鼠标时：
- 可以点击控制栏按钮进行播放/暂停、调整进度
- 无法通过拖动视频画面调整进度（仅触摸事件生效）
- 建议使用浏览器开发者工具的移动设备模拟器进行测试

### 3.2 移动设备测试建议

**推荐测试设备**：
- iOS Safari（iPhone）
- Android Chrome
- 不同屏幕尺寸（手机、平板）

**测试方法**：
1. 在移动设备上访问 http://[你的电脑IP]:13000
2. 按照上述测试步骤进行操作
3. 特别注意触摸反馈的流畅性和准确性

### 3.3 横屏模式测试

**测试步骤**：
1. 在移动设备上横屏显示
2. 重复上述所有交互测试
3. **预期结果**：所有功能正常工作，布局适配良好

---

## 四、性能测试

### 4.1 拖动流畅性测试

**测试步骤**：
1. 快速连续拖动视频进度
2. **预期结果**：
   - 预览时间更新流畅，无明显卡顿
   - 进度调整准确，无延迟

### 4.2 控制栏切换性能测试

**测试步骤**：
1. 快速连续单击视频画面
2. **预期结果**：
   - 控制栏显示/隐藏动画流畅
   - 无重复触发或状态错乱

---

## 五、已知问题和注意事项

### 5.1 安全性说明

- 密码验证在前端实现，仅适用于低安全要求场景
- 密码存储在环境变量中，可以被查看
- 如需高安全性，应实现后端 API 验证

### 5.2 浏览器兼容性

- 触摸事件需要现代浏览器支持
- 某些旧版浏览器可能无法正常工作
- 建议使用最新版本的 Chrome、Safari、Firefox

### 5.3 视频服务器要求

- 确保后端视频服务器（http://192.168.1.5:3003）正常运行
- 视频文件路径正确配置
- CORS 策略允许跨域访问

---

## 六、测试报告模板

### 测试日期：_____________
### 测试人员：_____________
### 测试设备：_____________

| 测试项 | 测试结果 | 备注 |
|--------|---------|------|
| 密码验证 - 错误密码 | ☑ 通过 / ☐ 失败 | |
| 密码验证 - 正确密码 | ☑ 通过 / ☐ 失败 | |
| 授权状态保持 | ☑ 通过 / ☐ 失败 | |
| 单击切换控制栏 | ☑ 通过 / ☐ 失败 | |
| 拖动调整进度 | ☑ 通过 / ☐ 失败 | |
| 进度预览气泡 | ☑ 通过 / ☐ 失败 | |
| 单击拖动区分 | ☑ 通过 / ☐ 失败 | |
| 控制栏自动隐藏 | ☑ 通过 / ☐ 失败 | |
| 横屏模式 | ☑ 通过 / ☐ 失败 | |

---

## 七、开发者调试指南

### 查看授权状态

在浏览器控制台执行：
```javascript
console.log(sessionStorage.getItem('authenticated'))
```

### 清除授权状态（用于重新测试）

在浏览器控制台执行：
```javascript
sessionStorage.removeItem('authenticated')
location.reload()
```

### 修改密码

编辑文件 `app/web/.env.local`：
```
NEXT_PUBLIC_APP_PASSWORD=你的新密码
```
重启开发服务器使修改生效。

### 禁用密码验证（跳过验证）

编辑文件 `app/web/.env.local`，注释掉密码配置：
```
# NEXT_PUBLIC_APP_PASSWORD=video123
```
重启开发服务器，系统将跳过密码验证，直接允许访问。
